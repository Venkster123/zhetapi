default_compiler: clang++
default_standard: c++17

definitions:
  - testing: 'testing/activation.cpp,
    testing/calculus.cpp,
    testing/fourier.cpp,
    testing/interval.cpp,
    testing/linalg.cpp,
    testing/main.cpp,
    testing/matrix.cpp,
    testing/polynomial.cpp,
    testing/printing.cpp,
    testing/special.cpp,
    testing/tensor.cpp,
    testing/timers.cpp,
    testing/vector.cpp'
  - source: 'source/range.cpp,
    source/autograd/activation.cpp,
    source/autograd/autograd.cpp,
    source/autograd/iseq.cpp,
    source/autograd/ml.cpp,
    source/io.cpp,
    source/linalg.cpp,
    source/polynomial.cpp,
    source/timer.cpp,
    source/std/functions.cpp,
    source/std/interval.cpp'
  - includes: '., vendor, vendor/indicators/include'

builds:
  - testing:
    - sources: testing, source
    - libraries: '-lpthread'
  - testing_debug:
    - sources: testing, source
    - libraries: '-lpthread'
    - flags: '-g'
  - experimental:
    - sources: 'experimental/experimental.cpp, source'
    - idirs: includes
  - experimental_debug:
    - sources: 'experimental/experimental.cpp, source'
    - flags: '-g -Wall'
    - idirs: includes
  - mnist:
    - sources: 'experimental/mnist.cpp, source'
    - idirs: includes
  - benchmark:
    - sources: 'experimental/benchmark.cpp, source'
    - flags: '-O3'

targets:
  - testing:
    - modes: gdb
    - builds:
      - default: testing
      - gdb: testing_debug
    - postbuilds:
      - default: '{}'
      - gdb: 'gdb {}'
  - exp:
    - modes: gdb, valgrind
    - builds:
      - default: experimental
      - gdb: experimental_debug
      - valgrind: experimental_debug
    - postbuilds:
      - default: '{}'
      - gdb: 'gdb {}'
      - valgrind: 'valgrind --leak-check=full {}'
  - mnist:
    - builds:
      - default: mnist
    - postbuilds:
      - default: '{}'
  - bench:
    - builds:
      - default: benchmark
    - postbuilds:
      - default: '{}'
